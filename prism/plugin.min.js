tinymce.PluginManager.requireLangPack("prism");tinymce.PluginManager.add("prism",function(c,b){function a(){var j,s=c.dom,x=c.selection,w={},v,p,l,k,d;var h={},u="markup",o=false,f,q="";var m=x.getNode();if(m.nodeName.toLowerCase()=="code"){var n=$(m).unwrap().text();n=n.replace(/\n/g,"<br>").replace(/<br><br>/g,"<p>").replace(/ /g,"&nbsp;").replace(/\t/g,"　　　　");x.setContent(n);m.remove()}else{h.linenumber=true;h.firstline="";h.highlight="";w.language="";w.firstline=h.firstline;w.linenumber=h.linenumber;w.highlight=h.highlight;var g=c.settings.prism_languages;var e=[{text:"HTML/XML",value:"markup"},{text:"CSS",value:"css"},{text:"C-like",value:"clike"},{text:"JavaScript",value:"javascript"}];var t=g?g:e;f=x.getContent({format:"text"});for(var r=0;r<t.length;r++){if(t[r].value==w.language){t[r].selected=true}}w.code=f;if(w.code==""){q="<br>"}if(w.code=="&nbsp;"){w.code=""}j=c.windowManager.open({title:"Prism - Code Editor",data:w,minWidth:450,body:[{name:"language",type:"listbox",values:t},{name:"code",type:"textbox",minHeight:200,multiline:true},{type:"form",padding:0,labelGap:5,spacing:5,align:"center",direction:"row",items:[{name:"linenumber",type:"checkbox",text:"Line Number",checked:w.linenumber},{name:"firstline",type:"textbox",label:"First Line",size:3,value:w.firstline},{name:"highlight",type:"textbox",label:"Highlight",size:10,value:w.highlight}]}],onsubmit:function(B){if(B.data.code===""){tinyMCE.activeEditor.windowManager.alert("Please insert your code.");return}else{var A=B.data.code;A=A.replace(/\</g,"&lt;").replace(/\>/g,"&gt;").replace(/　{4}/g,"\t");var C=B.data.language?B.data.language:u;var z=B.data.firstline?B.data.firstline:"";var y=B.data.linenumber?B.data.linenumber:false;var i=B.data.highlight?B.data.highlight:"";p=s.create("code",{"class":"language-"+C},A);if(y){l=' class="line-numbers"'}if(z!=""){k=' data-start="'+z+'"'}if(i!=""){d=' data-line="'+i+'"'}if(l===undefined){c.insertContent("<pre>"+s.getOuterHTML(p)+"</pre>"+q)}else{c.insertContent("<pre"+l+k+d+">"+s.getOuterHTML(p)+"</pre>"+q)}}}})}}c.addButton("prism",{icon:"codesample",tooltip:"Insert code with Prism",onPostRender:function(){var d=this;c.on("NodeChange",function(g){var f=g.element.parentNode;d.active(g.element.nodeName.toLowerCase()=="code"&&f.tagName.toLowerCase()=="pre")})},onclick:a});c.addMenuItem("prism",{text:"Prism",icon:"codesample",context:"insert",onclick:a})});